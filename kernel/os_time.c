/*
*********************************************************************************************************
* uC/OS-II
* The Real-Time Kernel
* TIME MANAGEMENT
*
* (c) Copyright 1992-2002, Jean J. Labrosse, Weston, FL
* All Rights Reserved
*
* File : OS_TIME.C
* By   : Jean J. Labrosse
*********************************************************************************************************
*/

#include "includes.h"

/*
*********************************************************************************************************
* Task Description
* 任务 1: 任务延时 (OSTimeDly)
*
* 描述:
* 将当前任务延时指定的系统节拍数 (ticks)。
*
* 功能:
* 1. 如果 ticks > 0：
* a. 从就绪表移除当前任务。
* b. 设置 TCB 中的 OSTCBDly。
* c. 触发调度。
*
* 移植要点:
* - 纯逻辑操作。
*********************************************************************************************************
*/
void  OSTimeDly (INT16U ticks)
{
    OS_CPU_SR cpu_sr;
    if(ticks > 0){
        OS_ENTER_CRITICAL();
        if((OSRdyTbl[OSTCBCur->OSTCBY] &= ~(OSTCBCur->OSTCBBitX)) == 0){
            OSRdyGrp &= ~(OSTCBCur->OSTCBBitY);
        }
        OSTCBCur->OSTCBDly = ticks;
        OS_EXIT_CRITICAL();
        OS_Sched();
    }
}

/*
*********************************************************************************************************
* Task Description
* 任务 2: 按时分秒延时 (OSTimeDlyHMSM)
*
* 描述:
* 将当前任务延时指定的时间（小时、分、秒、毫秒）。
*
* 功能:
* 1. 验证参数有效性。
* 2. 将时间转换为系统节拍数 (ticks)。
* 3. 调用 OSTimeDly。
*
* 移植要点:
* - 计算涉及 32 位乘法和除法。Mini2440 (ARM9) 硬件支持乘法，但除法需软件库支持，可能会增加些许开销。
*********************************************************************************************************
*/
INT8U  OSTimeDlyHMSM (INT8U hours, INT8U minutes, INT8U seconds, INT16U milli)
{
    // 在此输入代码
}

/*
*********************************************************************************************************
* Task Description
* 任务 3: 恢复延时任务 (OSTimeDlyResume)
*
* 描述:
* 唤醒一个正在延时的任务。
*
* 功能:
* 1. 检查任务是否存在且正在延时。
* 2. 清除 TCB 的 OSTCBDly。
* 3. 如果任务未被挂起，将其加入就绪表。
* 4. 触发调度。
*
* 移植要点:
* - 纯逻辑操作。
*********************************************************************************************************
*/
INT8U  OSTimeDlyResume (INT8U prio)
{
    // 在此输入代码
}

/*
*********************************************************************************************************
* Task Description
* 任务 4: 获取系统时间 (OSTimeGet)
*
* 描述:
* 获取自启动以来的总节拍数。
*
* 功能:
* 1. 进入临界区。
* 2. 读取 OSTime。
* 3. 退出临界区。
*
* 移植要点:
* - 在 32 位系统 (Mini2440) 上，读取 32 位整数通常是原子的，但为了可移植性和防止编译器优化问题，仍建议使用临界区。
*********************************************************************************************************
*/
INT32U  OSTimeGet (void)
{
    // 在此输入代码
}

/*
*********************************************************************************************************
* Task Description
* 任务 5: 设置系统时间 (OSTimeSet)
*
* 描述:
* 设置系统节拍计数器。
*
* 功能:
* 1. 进入临界区。
* 2. 写入 OSTime。
* 3. 退出临界区。
*
* 移植要点:
* - 同 OSTimeGet。
*********************************************************************************************************
*/
void  OSTimeSet (INT32U ticks)
{
    // 在此输入代码
}